var Jello=function(e,t){if(!t.name||!t.contentType||!e)throw"Invalid settings";return{listName:t.name,listContentType:t.contentType,requestDigest:null,getRequestDigest:function(){var e=this,t=$.Deferred();return e.requestDigest&&e.requestDigest.expiresOn>new Date?t.resolve():($.ajax({type:"POST",url:"https://jello.sharepoint.com/sites/sprest/_api/contextinfo",headers:{accept:"application/json;odata=verbose"}}).done(function(r){var n=(new Date).getTime();e.requestDigest=r.d.GetContextWebInformation,e.requestDigest.expiresOn=n+1e3*r.d.GetContextWebInformation.FormDigestTimeoutSeconds-6e4,console.log("Token",e.requestDigest.FormDigestValue),t.resolve()}).fail(function(){console.log("Error fetching Request Digest. Some parts won't work."),t.reject()}),t.promise())},get:function(r,n){var i=this,o=$.Deferred(),s="";if(i.filterObj.select||i.filterObj.filter||i.filterObj.expand||i.filterObj.orderBy)i.filterObj.expand&&(s=s.length>0?s+"&"+i.filterObj.expand:s+"?"+i.filterObj.expand),i.filterObj.select&&(s=s.length>0?s+"&"+i.filterObj.select:s+"?"+i.filterObj.select),i.filterObj.filter&&(s=s.length>0?s+"&"+i.filterObj.filter:s+"?"+i.filterObj.filter),i.filterObj.orderBy&&(s=s.length>0?s+"&"+i.filterObj.orderBy:s+"?"+i.filterObj.orderBy),r&&(s=s.length>0?s+"&$top="+r:s+"?$top="+r),i.filterObj={filter:null,expand:null,select:null,orderBy:null},console.log("Query",s);else var s=r?"?$top="+r:"";return n=n?n:e+"/_api/web/lists/getbytitle('"+t.name+"')/items"+s,$.ajax({type:"GET",headers:{accept:"application/json;odata=verbose"},url:n}).done(function(e){e.next=function(){var t=$.Deferred();return i.get(null,e.d.__next).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise()},e.prev=function(){var t=$.Deferred();return i.get(null,e.d.__prev).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise()},o.resolve(e)}).fail(function(e){o.reject(e)}),o.promise()},getById:function(r){var n=$.Deferred();if(!r)throw"Provided ID is not valid";return $.ajax({type:"GET",headers:{accept:"application/json;odata=verbose"},url:e+"/_api/web/lists/getbytitle('"+t.name+"')/items("+r+")"}).done(function(e){n.resolve(e)}).fail(function(e){n.reject(e)}),n.promise()},add:function(r){var n=this,i=$.Deferred();return this.getRequestDigest().then(function(){r.__metadata={type:n.listContentType};var o=JSON.stringify(r);$.ajax({type:"POST",headers:{accept:"application/json;odata=verbose","content-type":"application/json;odata=verbose","X-RequestDigest":n.requestDigest.FormDigestValue},data:o,url:e+"/_api/web/lists/getbytitle('"+t.name+"')/items"}).done(function(e){i.resolve(e)}).fail(function(e){i.reject(e)})},function(e){i.reject(e)}),i.promise()},remove:function(r,n){n||(n="*");var i=this,o=$.Deferred();return this.getRequestDigest().then(function(){$.ajax({type:"POST",headers:{"X-RequestDigest":i.requestDigest.FormDigestValue,"X-HTTP-Method":"DELETE","If-Match":n},url:e+"/_api/web/lists/getbytitle('"+t.name+"')/items("+r+")"}).done(function(e){o.resolve(e)}).fail(function(e){o.reject(e)})},function(e){o.reject(e)}),o.promise()},update:function(r,n,i){i||(i="*");var o=this,s=$.Deferred();return this.getRequestDigest().then(function(){n.__metadata={type:o.listContentType};var a=JSON.stringify(n);$.ajax({type:"POST",headers:{accept:"application/json;odata=verbose","content-type":"application/json;odata=verbose","X-RequestDigest":o.requestDigest.FormDigestValue,"X-HTTP-Method":"MERGE","If-Match":i},data:a,url:e+"/_api/web/lists/getbytitle('"+t.name+"')/items("+r+")"}).done(function(e){s.resolve(e)}).fail(function(e){s.reject(e)})},function(e){s.reject(e)}),s.promise()},query:function(r){var n=$.Deferred();return r=r?"?"+r:"",$.ajax({type:"GET",headers:{accept:"application/json;odata=verbose"},url:e+"/_api/web/lists/getbytitle('"+t.name+"')/items"+r}).done(function(e){n.resolve(e)}).fail(function(e){n.reject(e)}),n.promise()},filterObj:{filter:null,expand:null,select:null,orderBy:null},where:function(e){var t=this;return t.filterObj.filter="$filter="+e,t},expand:function(e){var t=this;return t.filterObj.expand="$expand="+e,t},select:function(e){var t=this;return t.filterObj.select="$select="+e,t},orderBy:function(e){var t=this;return t.filterObj.orderBy="$orderby="+e,t}}};