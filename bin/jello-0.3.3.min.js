var Jello=function(e){var t=this;this.siteUrl=e,this.requestDigest=null;var r=function(){var r=$.Deferred();return t.requestDigest&&t.requestDigest.expiresOn>new Date?r.resolve():($.ajax({type:"POST",url:e+"/_api/contextinfo",headers:{accept:"application/json;odata=verbose"}}).done(function(e){var n=(new Date).getTime();t.requestDigest=e.d.GetContextWebInformation,t.requestDigest.expiresOn=n+1e3*e.d.GetContextWebInformation.FormDigestTimeoutSeconds-6e4,console.log("Token",t.requestDigest.FormDigestValue),r.resolve()}).fail(function(e){console.log("Error fetching Request Digest. Some parts won't work."),r.reject()}),r.promise())};this.Web=function(){throw"Not implemented"},this.List=function(){throw"Not implemented"},this.Files=function(e){throw"Not implemented"},this.ListItems=function(n){var o=n.name,i={filter:null,expand:null,select:null,orderBy:null},a=n.contentType,s=function(t){var r=$.Deferred(),n="";return i.select||i.filter||i.expand||i.orderBy?(i.expand&&(n=n.length>0?n+"&"+i.expand:n+"?"+i.expand),i.select&&(n=n.length>0?n+"&"+i.select:n+"?"+i.select),i.filter&&(n=n.length>0?n+"&"+i.filter:n+"?"+i.filter),i.orderBy&&(n=n.length>0?n+"&"+i.orderBy:n+"?"+i.orderBy),t&&(n=n.length>0?n+"&$top="+t:n+"?$top="+t),i={filter:null,expand:null,select:null,orderBy:null}):n=t?"?$top="+t:"",url=e+"/_api/web/lists/getbytitle('"+o+"')/items"+n,$.ajax({type:"GET",headers:{accept:"application/json;odata=verbose"},url:url}).done(function(e){e.next=function(){var t=$.Deferred();return s(null,e.d.__next).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise()},e.prev=function(){var t=$.Deferred();return s(null,e.d.__prev).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise()},r.resolve(e)}).fail(function(e){r.reject(e)}),r.promise()},u=function(t){var r=$.Deferred();if(!t)throw"Provided ID is not valid";return $.ajax({type:"GET",headers:{accept:"application/json;odata=verbose"},url:e+"/_api/web/lists/getbytitle('"+o+"')/items("+t+")"}).done(function(e){r.resolve(e)}).fail(function(e){r.reject(e)}),r.promise()},l=function(n){var i=$.Deferred();return r().then(function(){n.__metadata={type:a};var r=JSON.stringify(n);$.ajax({type:"POST",headers:{accept:"application/json;odata=verbose","content-type":"application/json;odata=verbose","X-RequestDigest":t.requestDigest.FormDigestValue},data:r,url:e+"/_api/web/lists/getbytitle('"+o+"')/items"}).done(function(e){i.resolve(e)}).fail(function(e){i.reject(e)})},function(e){i.reject(e)}),i.promise()},c=function(n,i){i||(i="*");var a=$.Deferred();return r().then(function(){$.ajax({type:"POST",headers:{"X-RequestDigest":t.requestDigest.FormDigestValue,"X-HTTP-Method":"DELETE","If-Match":i},url:e+"/_api/web/lists/getbytitle('"+o+"')/items("+n+")"}).done(function(e){a.resolve(e)}).fail(function(e){a.reject(e)})},function(e){a.reject(e)}),a.promise()},m=function(n,i,s){s||(s="*");var u=$.Deferred();return r().then(function(){i.__metadata={type:a};var r=JSON.stringify(i);$.ajax({type:"POST",headers:{accept:"application/json;odata=verbose","content-type":"application/json;odata=verbose","X-RequestDigest":t.requestDigest.FormDigestValue,"X-HTTP-Method":"MERGE","If-Match":s},data:r,url:e+"/_api/web/lists/getbytitle('"+o+"')/items("+n+")"}).done(function(e){u.resolve(e)}).fail(function(e){u.reject(e)})},function(e){u.reject(e)}),u.promise()},f=function(t){var r=$.Deferred();return t=t?"?"+t:"",$.ajax({type:"GET",headers:{accept:"application/json;odata=verbose"},url:e+"/_api/web/lists/getbytitle('"+o+"')/items"+t}).done(function(e){r.resolve(e)}).fail(function(e){r.reject(e)}),r.promise()},d=function(e){return i.filter="$filter="+e,this},p=function(e){return i.expand="$expand="+e,this},g=function(e){return i.select="$select="+e,this},T=function(e){return i.orderBy="$orderby="+e,this};return{get:s,getById:u,add:l,remove:c,update:m,query:f,where:d,expand:p,select:g,orderBy:T}},this.Taxonomy=function(e){if(!SP.Taxonomy)throw"SP.Taxonomy is not loaded. Please ensure SP.Taxonomy is loaded before proceeding.";if(!e.TermStore)throw"TermStore null or undefined";var t=e.TermStore,r=function(e){if(!e)throw"Term set ID null or undefined.";return $.Deferred(function(r){var n=SP.ClientContext.get_current(),o=SP.Taxonomy.TaxonomySession.getTaxonomySession(n),i=o.get_termStores(),a=i.getByName(t),s=a.getTermSet(e),u=s.getAllTerms();n.load(u),n.executeQueryAsync(function(){r.resolve(u)},function(e,t){r.reject(t)})})},n=function(e){if(!e||!e.Name||!e.GUID)throw"Name or GUID is null or undefined";return $.Deferred(function(r){var n=SP.ClientContext.get_current(),o=SP.Taxonomy.TaxonomySession.getTaxonomySession(n),i=o.get_termStores(),a=i.getByName(t),s=a.createGroup(e.Name,e.GUID);n.load(s),n.executeQueryAsync(function(){r.resolve(s)},function(e,t){r.reject(t)})})},o=function(e){if(!(e&&e.GroupGUID&&e.TermSetName&&e.TermSetGUID&&e.TermSetLCID))throw"One or more parameters null or undefined. Required parameters are GroupGUID, TermSetName, TermSetGUID, TermSetLCID";return $.Deferred(function(r){var n=SP.ClientContext.get_current(),o=SP.Taxonomy.TaxonomySession.getTaxonomySession(n),i=o.get_termStores(),a=i.getByName(t),s=a.getGroup(e.GroupGUID),u=s.createTermSet(e.TermSetName,e.TermSetGUID,e.TermSetLCID);n.load(u),n.executeQueryAsync(function(){r.resolve(u)},function(e,t){r.reject(t)})})},i=function(e){if(!(e&&e.TermSetGUID&&e.TermName&&e.TermLCID&&e.TermGUID))throw"One or more parameters null or undefined. Required parameters are TermSetGUID, TermName, TermLCID, TermGUID";return $.Deferred(function(r){var n=SP.ClientContext.get_current(),o=SP.Taxonomy.TaxonomySession.getTaxonomySession(n),i=o.get_termStores(),a=i.getByName(t),s=a.getTermSet(e.TermSetGUID),u=s.createTerm(e.TermName,e.TermLCID,e.TermGUID);u.set_isAvailableForTagging(e.isAvailableForTagging),n.load(u),n.executeQueryAsync(function(){r.resolve(u)},function(e,t){r.reject(t)})})},a=function(e){if(!e)throw"GUID is null or undefined.";return $.Deferred(function(t){var r='<View><Query><Where><Eq><FieldRef Name="IdForTerm"/><Value Type="Text">'+e+"</Value></Eq></Where></Query></View>",n=SP.ClientContext.get_current(),o=n.get_web().get_lists().getByTitle("TaxonomyHiddenList"),i=new SP.CamlQuery;i.set_viewXml(r);var a=o.getItems(i);n.load(a),n.executeQueryAsync(function(){for(var e=a.getEnumerator(),r=[];e.moveNext();){var n=e.get_current();r.push(n.get_id())}t.resolve(r)},function(e,r){t.reject(r)})})};return{getAllTerms:r,addTermGroup:n,addTermSet:o,addTerm:i,getWssIdFromGuid:a}}};module.exports=Jello;