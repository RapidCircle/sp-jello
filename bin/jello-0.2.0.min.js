var Jello=function(e,t){if(!t.name||!t.contentType||!e)throw"Invalid settings";return{listName:t.name,listContentType:t.contentType,requestDigest:null,getRequestDigest:function(){var e=this,t=$.Deferred();return e.requestDigest&&e.requestDigest.expiresOn>new Date?t.resolve():($.ajax({type:"POST",url:"https://jello.sharepoint.com/sites/sprest/_api/contextinfo",headers:{accept:"application/json;odata=verbose"}}).done(function(i){var n=(new Date).getTime();e.requestDigest=i.d.GetContextWebInformation,e.requestDigest.expiresOn=n+1e3*i.d.GetContextWebInformation.FormDigestTimeoutSeconds-6e4,console.log("Token",e.requestDigest.FormDigestValue),t.resolve()}).fail(function(){console.log("Error fetching Request Digest. Some parts won't work."),t.reject()}),t.promise())},get:function(i){var n=$.Deferred(),o=i?"?$top="+i:"";return $.ajax({type:"GET",headers:{accept:"application/json;odata=verbose"},url:e+"/_api/web/lists/getbytitle('"+t.name+"')/items"+o}).done(function(e){n.resolve(e)}).fail(function(e){n.reject(e)}),n.promise()},getById:function(i){var n=$.Deferred();if(!i)throw"Provided ID is not valid";return $.ajax({type:"GET",headers:{accept:"application/json;odata=verbose"},url:e+"/_api/web/lists/getbytitle('"+t.name+"')/items("+i+")"}).done(function(e){n.resolve(e)}).fail(function(e){n.reject(e)}),n.promise()},add:function(i){var n=this,o=$.Deferred();return this.getRequestDigest().then(function(){i.__metadata={type:n.listContentType};var s=JSON.stringify(i);$.ajax({type:"POST",headers:{accept:"application/json;odata=verbose","content-type":"application/json;odata=verbose","X-RequestDigest":n.requestDigest.FormDigestValue},data:s,url:e+"/_api/web/lists/getbytitle('"+t.name+"')/items"}).done(function(e){o.resolve(e)}).fail(function(e){o.reject(e)})},function(e){o.reject(e)}),o.promise()},remove:function(i,n){n||(n="*");var o=this,s=$.Deferred();return this.getRequestDigest().then(function(){$.ajax({type:"POST",headers:{"X-RequestDigest":o.requestDigest.FormDigestValue,"X-HTTP-Method":"DELETE","If-Match":n},url:e+"/_api/web/lists/getbytitle('"+t.name+"')/items("+i+")"}).done(function(e){s.resolve(e)}).fail(function(e){s.reject(e)})},function(e){s.reject(e)}),s.promise()},update:function(i,n,o){o||(o="*");var s=this,r=$.Deferred();return this.getRequestDigest().then(function(){n.__metadata={type:s.listContentType};var a=JSON.stringify(n);$.ajax({type:"POST",headers:{accept:"application/json;odata=verbose","content-type":"application/json;odata=verbose","X-RequestDigest":s.requestDigest.FormDigestValue,"X-HTTP-Method":"MERGE","If-Match":o},data:a,url:e+"/_api/web/lists/getbytitle('"+t.name+"')/items("+i+")"}).done(function(e){r.resolve(e)}).fail(function(e){r.reject(e)})},function(e){r.reject(e)}),r.promise()},query:function(i){var n=$.Deferred();return i=i?"?"+i:"",$.ajax({type:"GET",headers:{accept:"application/json;odata=verbose"},url:e+"/_api/web/lists/getbytitle('"+t.name+"')/items"+i}).done(function(e){n.resolve(e)}).fail(function(e){n.reject(e)}),n.promise()}}};